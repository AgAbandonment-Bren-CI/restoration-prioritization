---
title: "Prioritization of cropland restoration"
author: "Nick McManus"
date: '2022-10-13'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(prioritizr)    # optimization software! 
library(terra)         # for reading in and altering rasters
library(sf)
library(raster)
library(tidyverse)     # always!
library(rnaturalearth) # administrative boundaries data
library(rnaturalearthdata)
```

## Read in data{.tabset}

### Cropland Abandonment
Read in areas of projected cropland abandonment for five different SSP scenarios in Brazil. This data was generated from code located in the `abandoned-cropland` repository.
```{r}
# read in the cropland abandonment
ssp1_abandoned_crop <- rast("data/inputs/SSP1_abandoned_cropland_brazil.tif")
ssp2_abandoned_crop <- rast("data/inputs/SSP2_abandoned_cropland_brazil.tif")
ssp3_abandoned_crop <- rast("data/inputs/SSP3_abandoned_cropland_brazil.tif")
ssp4_abandoned_crop <- rast("data/inputs/SSP4_abandoned_cropland_brazil.tif")
ssp5_abandoned_crop <- rast("data/inputs/SSP5_abandoned_cropland_brazil.tif")
```

### Carbon sequestraion rates
Read in global carbon sequestration layer. Data sources from XYZ.....

After reading in the global layer, we will crop it to Brazil and save the outputs. 
```{r, eval=FALSE}
#NOTE: this code chunk defaults to not evaluate.
#only needs to be run once and cropped raster is saved

# read in carbon layer
carbon_global <- rast("data/inputs/sequestration_rate_mean_aboveground_full_extent_Mg_C_ha_yr.tif")

# read in Brazil shape file from natural earth
brazil <- ne_countries(
  scale = "medium",
  country = "Brazil",
  returnclass = "sf") %>% 
  dplyr::select(sovereignt)

# transform Brazil coordinate reference system to carbon raster
# quicker than transforming a global layer
brazil_trans <- brazil %>% 
  st_transform(crs = crs(carbon_global)) %>% 
  vect()

# Crop carbon data to Brazil, then reproject back to crs of interest
carbon_brazil <- carbon_global %>% 
  crop(brazil_trans) %>% 
  mask(brazil_trans) %>% 
  terra::project(y = crs(brazil))

# test plot to visualize results
plot(carbon_brazil)

#export carbon_brazil as intermediate raster
writeRaster(carbon_brazil, "data/outputs/carbon_seq_rate_Brazil.tif")
```


### Biodiversity
Read in biodiversity data. Info about the data and where it is from. 

After reading in the global layer, we will crop it to Brazil and save the outputs. 

```{r}
#read in global biodiversity data
biodiversity_global <- rast("data/inputs/sparc_conservationPriorities.tif")

# transform Brazil coordinate reference system to carbon raster
# quicker than transforming a global layer
brazil_bio <- brazil %>% 
  st_transform(crs = crs(biodiversity_global)) %>% 
  vect()

# crop biodiversity layer to Brazil
biodiversity_brazil <- biodiversity_global %>% 
  crop(brazil_bio) %>% 
  mask(brazil_bio) %>% 
  terra::project(y=crs(brazil))

# test plot to visualize results
plot(biodiversity_brazil)

#export biodiversity_brazil as intermediate raster
writeRaster(biodiversity_brazil, "data/outputs/sparc_conservationPriorities_Brazil.tif")
```


### Cost Layer

# bee boop bip bop cost cost cost

## Problem Formulations

This is where we will start formulating the problem to be solved in prioritizr!